{extend name='admin'/}
{block name="content"}

    <ul class="nav nav-tabs" role="tablist">
        <li><a href="{:url('index')}">商品管理</a></li>
        <li class="active"><a href="">商品编辑</a></li>
    </ul>
    <form class="form-horizontal" onsubmit="return goodsEdit()" id="form" action="" method="post">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">商品管理</h3>
            </div>
            <div class="panel-body">
                <div class="form-group">
                    <label for="" class="col-sm-2 control-label">商品名称</label>
                    <div class="col-sm-9">
                        <input type="text" name="gname" value="{$attr['gname']}" class="form-control" placeholder="请填写商品名称">
                    </div>
                </div>
                <div class="form-group">
                    <label for="" class="col-sm-2 control-label">所属分类</label>
                    <div class="col-sm-9">
                        <select class="js-example-basic-single form-control" name="cid">
                            <option value="0">请选择分类</option>
                            {foreach $Ldata as $val}
                            <option value="{$val['id']}" {if $attr['pid'] == $val['id']} selected="selected"{/if} tid="{$val['id']}">{$val['tname']}</option>
                            {/foreach}
                        </select>
                    </div>
                </div>
                <!--//添加按钮-->
                <script>
                    $(function () {
                        $('#spec').delegate('.addspec','click',function () {
                            //复制父级tr
                            var tr = $(this).parents('tr').clone();
                            //移除原有的添加按钮
                            tr.find('.addspec').remove();
                            var del = '<button type="button" class="btn btn-danger btn-xs delspec">删除</button>';
                            //在原来删除的位置添加一个删除按钮
                            tr.find('td').eq(4).append(del);
                            $(this).parents('tr').after(tr);
                        })
                        $('#spec').delegate('.delspec','click',function () {
                            $(this).parents('tr').remove();
                        })
                    })
                </script>
<!--                 <div class="form-group">
                    <label for="" class="col-sm-2 control-label">商品属性</label>
                    <div class="col-sm-9" id="attr">
                        <table class="table table-striped">
                            <foreach from="" key="$k" value="$v">
                            <tr>
                                <td></td>
                                <td>
                                    <select name="attr[]">
                                        <option value="0">请选择</option>
                                        <foreach from="" key="$key" value="">
                                        <option <if value="">selected="selected"</if> ">213456</option>
                                        </foreach>
                                    </select>
                                </td>
                            </tr>
                            </foreach>
                        </table>
                    </div>
                </div> -->
                <!-- <div class="form-group">
                    <label for="" class="col-sm-2 control-label">商品规格</label>
                    <div class="col-sm-9" id="spec">
                        <table class="table table-striped">
                            <foreach from="$poData" key="$k" value="$v">
                                <tr>
                                    <td></td>
                                    <td>
                                        <select name="">
                                            <option value="0">请选择</option>
                                            <foreach from="" key="$key" value="$value">
                                                <option <if value=$v['gtvalue'] == $value">selected="selected"</if></option>
                                            </foreach>
                                        </select>
                                    </td>
                                    <td>附加价格</td>
                                    <td><input type="text" name="" value=""></td>
                                    <td><button type="button" class="btn btn-danger btn-xs delspec">删除</button></td>
                                </tr>
                                <script>
                                    $(function(){
                                        $("#spec").find("tr:contains('')").eq(0).find("td:last").html('<button type="button" class="btn btn-primary btn-xs addspec">添加</button>');
                                    })
                                </script>
                            </foreach>
                        </table>
                    </div>
                </div> -->

                <!-- <div class="form-group">
                    <label for="" class="col-sm-2 control-label">单位</label>
                    <div class="col-sm-9">
                        <input type="text" name="unit" value="" class="form-control" placeholder="">
                    </div>
                </div>
                <div class="form-group">
                    <label for="" class="col-sm-2 control-label">市场价</label>
                    <div class="col-sm-9">
                        <input type="text" name="marketprice" value="" class="form-control" placeholder="">
                    </div>
                </div>
                <div class="form-group">
                    <label for="" class="col-sm-2 control-label">商城价</label>
                    <div class="col-sm-9">
                        <input type="text" name="shopprice" value="" class="form-control" placeholder="">
                    </div>
                </div>
                <div class="form-group">
                    <label for="" class="col-sm-2 control-label">总库存</label>
                    <div class="col-sm-9">
                        <input type="text" name="total" value="" class="form-control" placeholder="">
                    </div>
                </div> -->
                <div class="form-group">
                    <label for="" class="col-sm-2 control-label">基础价格</label>
                    <div class="col-sm-9">
                        <input type="text" name="price"  class="form-control" value="{$attr['price']}">
                    </div>
                </div>
                <div class="form-group">
                    <label for="" class="col-sm-2 control-label">库存</label>
                    <div class="col-sm-9">
                        <input type="text" name="num"  class="form-control" value="{$attr['num']}">
                    </div>
                </div>
                <div class="form-group">
                    <label for="" class="col-sm-2 control-label">列表图</label>
                    <div class="col-sm-9">
                        <div class="input-group">
                            <input type="text" class="form-control" name="pic" readonly="" value="">
                            <div class="input-group-btn">
                                <button onclick="upImage(this)" class="btn btn-default" type="button" >选择图片
                                </button>
                            </div>
                        </div>
                        <div class="input-group" style="margin-top:5px;">
                            <img  src="{$attr['pic']}" class="img-responsive img-thumbnail liebiaotu"
                                 width="150" height="100">
                        </div>
                        <span class="help-block">建议大小(宽100高100)</span>
                    </div>
                </div>
                <div class="form-group">
                    <label for="" class="col-sm-2 control-label">所属分类</label>
                    <div class="col-sm-9">
                        <select class="js-example-basic-single form-control" name="status">
                            {if $attr['status']}
                            <option value="1" selected="selected">上架</option>
                            <option value="0">下架</option>
                            {else}
                            <option value="1">上架</option>
                            <option value="0" selected="selected">下架</option>
                            {/if}
                        </select>
                    </div>
                </div>
                <!-- <div class="form-group">
                    <label for="" class="col-sm-2 control-label">商品图册</label>
                    <div class="col-sm-9">
                        <div class="input-group">
                            <div class="input-group-btn">
                                <button onclick="manyupImage(this)" class="btn btn-default" type="button">选择图片</button>
                            </div>
                        </div>
                        <div class="input-group" id="box" style="margin-top:5px;">
                            <foreach from="$detailData['big']" key="$k" value="$v">
                                <div style="padding: 5px;position: relative;float: left">
                                    <li style="float: left;list-style: none;">
                                        <img src="" alt="" width="150" class="img-responsive img-thumbnail">
                                        <input type="hidden" name="logo[]" value="">
                                    </li>
                                    <span onclick="removeManyImg(this)" style="color:red;position: absolute;right: 10px;top:5px;cursor: pointer">X</span>
                                </div>
                            </foreach>
                        </div>
                        <span class="help-block">建议大小(宽100高100)</span>
                    </div>
                </div> -->
                <!-- <div class="form-group">
                    <label for="" class="col-sm-2 control-label">点击次数</label>
                    <div class="col-sm-9">
                        <input type="text" name="click" value="" class="form-control" placeholder="">
                    </div>
                </div> -->

                <div class="form-group">
                    <label class="col-sm-2 control-label">商品详情</label>
                    <div class="col-sm-9">
                        <textarea id="intro" name="describe" style="height:300px;width:100%;">{$attr['describe']}</textarea>
                    </div>
                </div>
                <!-- <div class="form-group">
                    <label class="col-sm-2 control-label">售后服务</label>
                    <div class="col-sm-9">
                        <textarea id="service" name="service" style="height:300px;width:100%;"></textarea>
                    </div>
                </div> -->
            </div>
        </div>
        <input type="hidden" name="gid" value="">
        <input type="hidden" name="tid" value="">
        <button class="btn btn-primary" type="submit">确定</button>
    </form>
{/block}
<script>
    //商品图册删除
    function removeManyImg(obj)
    {
        $(obj).parent().remove();
    }
</script>
<script>
    //上传
    function upImage(obj) {
        require(['util'], function (util) {
            util.image(function (images) {
                $("[name='pic']").val(images[0]);
                $(".liebiaotu").attr('src', images[0]);
            }, {})
        })
    }
    //百度编辑器
    require(['util'], function (util) {
        util.ueditor('container', {}, function (editor) {
            //这是回调函数 editor是百度编辑器实例
        });
    })
</script>
<script>
    //上传图片
    function manyupImage(obj) {
        require(['util'], function (util) {
            options = {
                //上传多图
                multiple: true,
            };
            util.image(function (images) {
                $(images).each(function(k,v){
                    $('<li style="float: left;list-style: none"> <img src="'+v+'" class="img-responsive img-thumbnail" height="100" width="150"><input type="hidden" name="logo[]" value="'+v+'"></li>').appendTo('#box');
                })
                $('.cha').remove();
            }, options)
        });
    }
</script>
<script>
    util.ueditor('service', {hash:2,data:'hd'}, function (editor) {
        //这是回调函数 editor是百度编辑器实例
    });
    util.ueditor('intro', {hash:2,data:'hd'}, function (editor) {
        //这是回调函数 editor是百度编辑器实例
    });
</script>
<script>
    function goodsEdit()
    {
        var data = $('#form').serialize();
        $.post("{{u('edit')}}",data,function (res) {
            if(res.valid)
            {//成功
                //参数：提示消息，跳转地址，成功
                util.message(res.message,"{{u('index')}}",'success');
            }else{//失败
                util.message(res.message,"",'error');
            }
        },'json')
        return false;
    }
</script>